.. _imp5hcd_in_ets:

IMP5 contributions to ETS
=========================

The IMP5 codes have been included in the ETS using the
IMP5HCD
composite actor. In addition a composite actor for generating an initial
state of the IMP5 cpos, including the input cpos Antennas and NBI has
been provided.
.. _imp5_composite_actor_hcd__import_into_ETS:

Import a new version of IMP5HCD into the ETS
--------------------------------------------

Importing the IMP5HCD into the ETS is still not done automatically. Here
follows a description for how to import a new version of the IMP5HCD
into the ETS.

.. _imp5_composite_actor_hcd__import_into_ETS__export_imp5hcd:

Export IMP5HCD composite actors
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The first step is to extract composite actors from the IMP5HCD_SA. To do
this, go to the directory imp5hcd/ and run the command:

::

   make composite_actors

This will add the composite actors IMP5HCD, IMP5HCD_CORE and
initial_IMP5_state as actors in your kepler folder.

.. _imp5_composite_actor_hcd__import_into_ETS__transfer_settings:

Transfer IMP5HCD settings
~~~~~~~~~~~~~~~~~~~~~~~~~

First, note that these setting only need to be transferred when the
setting parameters used in the IMP5HCD has been changed. Also, the
setting cannot be transferred in the Kepler-gui. Instead this can be
done directly in the xml using a text editor.

First step here is to copy the setting from the file imp5hcd_sa.xml. To
copy the settings copy all text starting from the element named

::

   ---- Start IMP5HCD settings

and ending with the element

::

   ---- End IMP5HCD settings

Then replace the corresponding section in the file ETS_WORKFLOW.xml.

.. _imp5_composite_actor_hcd__import_into_ETS__import_imp5hcd_core:

Import IMP5HCD_CORE composite actors
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Next, download the ETS workflow, import the ETS actors and open the
workflow (`here are detailed instructions for each of these
steps <#ETS_A_KEPLER>`__) . Inside the ETS we find the IMP5HCD by first
opening up the "Convergence Loop" Here we may edit the IMP5HCD settings
by double clicking on the actor "Update SOURCE and IMPURITY".

Next, open "Update SOURCE and IMPURITY" Open the "HCD" Open the "HCD
Sources ON" We are now at the place where the "IMP5HCD_CORE" should be
imported. First, identify the old version of IMP5HCD Actor, marked in
yellow in the figure below. Then search for the "IMP5HCD_CORE" among
Components/Search Components, as shown in the figure below. Drag the
"IMP5HCD_CORE" into the workflow to replace the old version.

.. _imp5_composite_actor_hcd__import_initimp5cpos_into_ETS:

Import a new version of "initial_imp5_state" into the ETS
---------------------------------------------------------

Here follows a description for how to import a new version of the
composite actor "initial_imp5_state" into the ETS.

The first step to import the "initial_IMP5_state" is to extract the
composite actor, as described
`here <#imp5_composite_actor_hcd__import_into_ETS__export_imp5hcd>`__.
Next open the workflow ETS_WORKFLOW.xml In the ETS_WORKFLOW_V2.1.xml
workflow, open the Actor "BEFORE THE TIME EVOLUTION" Next, open the
Actor "HCD settings" We're now at the place where the new
"initial_imp5_state" Actor should be imported. First, identify the old
version of the Actor, marked in yellow in the figure below. Then search
for the "initial_imp5_state" among Components/Search Components, as
shown in the figure below. Drag the "initial_imp5_state" into the
workflow to replace the old version.

.. _Proceedure_for_providing_a_physics_module_to_the_IMP5HCD_and_the_ETS:

Proceedure for providing a physics module to the IMP5HCD and the ETS
--------------------------------------------------------------------

The following is a proceedure for coupling an actor (physics module) to
the ETS:

1. Build an single-code-workflow for testing your actor. This workflow
   may include only UALinit, the actor with "your physics module" and
   the UAL collector; all coupled serially. One such example is the
   Mars workflow
   , which include also advanced features like a phytons visualisation
   actor.
2. Verify that your actor reproduces results obtained in previous
   non-Kepler based version of your code
3. Download the IMP5HCD-SA workflow (see
   Accessing the IMP5HCD-SA workflow
   )
4. Import your actor into the IMP5HCD
5. Verify that you get the same result that you got in your
   single-code-workflow
6. Download the ETS workflow
7. Import your version of the IMP5HCD into the ETS workflow (see
   Import IMP5HCD into the ETS
   )
8. Verify that your code give the correct result in the ETS
9. Verify that your is correctly captured in the coresource CPO
   generated by the workflow
